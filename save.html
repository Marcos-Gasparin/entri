<!-- Parte 1 -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entri Integration</title>
    <script src="https://cdn.goentri.com/entri.js"></script> <!-- Substitua com a URL correta -->
</head>
<body>
    <h1>Welcome to My Website</h1>
    <p>Click the button below to launch Entri.</p>

    <button type="button" id="launchEntri" disabled>Loading...</button>

    <script>
        // 1. Referência ao botão
        const button = document.getElementById("launchEntri");

        // 2. Parâmetros do Entri (substitua pelos valores reais)
        const applicationId = "marcos_se";
        const secret = "dc9fc4a0e2016cc2e78153778518d0c01705274b94983fa31c13597419e0e716";
        const recordsContent = [{
            "value": "s.multiscreensite.com",
            "host": "www",
            "ttl": 300,
            "type": "CNAME"
            },
            {
            "value": "35.172.94.1",
            "host": "@",
            "ttl": 300,
            "type": "A"
            },
            {
            "value": "domain-verification=JGNoXe",
            "host": "@",
            "ttl": 300,
            "type": "TXT"
            }];  // Caso precise adicionar DNS records

        // 3. Função assíncrona para obter o JWT e criar a config
        async function connectFlow() {
            try {
                const response = await fetch('https://api.goentri.com/token', {
                    method: 'POST',
                    body: JSON.stringify({
                        applicationId: applicationId,
                        secret: secret
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                const jwt = data.auth_token;  // Obtém o JWT

                console.log('JWT Token:', jwt);

                // 4. Define window.config após obter o JWT
                window.config = {
                    applicationId: applicationId,
                    token: jwt,
                    prefilledDomain: "example.com",
                    dnsRecords: recordsContent,
                    whiteLabel: {
                        "hideEntriLogo": true,
                        "hideConfetti": true,
                        "logo": "https://static-00.iconduck.com/assets.00/random-1dice-icon-437x512-ksswhjk8.png",
                        "theme": {
                        "fg": "#fff",
                        "bg": "#fa7268"
                        },
                        "logoBackgroundColor": "#444444",
                        "removeLogoBorder": true,
                        "customCopy": {
                        "initialScreen": {
                            "title": {
                            "en": "Custom title",
                            "es": "Título custom"
                            },
                            "subTitle": {
                            "en": "Custom subtitle",
                            "es": "Subtítulo custom"
                            }
                        },
                        "manuallyScreen": {
                            "disableManualSetupDocumentationLink": true,
                            "stepByStepGuide": {
                            "en": "Follow our <link>step-by-step</link> guide",
                            "es": "Sigue nuestra guía <link>paso-a-paso</link>"
                            }
                        }
                        }
  
                    }
                };

                console.log('Config:', window.config);

                // 5. Habilita o botão e adiciona o evento de clique
                button.disabled = false;
                button.textContent = "Launch Entri";
                button.addEventListener("click", function () {
                    entri.showEntri(window.config);
                });

            } catch (error) {
                console.error('Erro ao obter o JWT ou criar o config:', error);
                button.textContent = "Failed to Load Entri";
            }
        }

        // 6. Espera o Entri ser carregado antes de iniciar o fluxo
        function checkEntriLoaded() {
            if (typeof entri !== "undefined") {
                console.log("Entri is loaded and ready to use.");
                connectFlow();  // Chama a função para obter o JWT e configurar o botão
            } else {
                console.error("Entri ainda não carregou. Tentando novamente...");
                setTimeout(checkEntriLoaded, 500); // Tenta novamente depois de 500ms
            }
        }

        // 7. Aguarda o DOM estar carregado antes de verificar o Entri
        document.addEventListener("DOMContentLoaded", checkEntriLoaded);

        function handleOnEntriClose(event) {
            console.log('onEntriClose', event.detail);
            }
        window.addEventListener('onEntriClose', handleOnEntriClose, false);
    </script>
</body>
</html>
